<VirtualHost *:80>
    DocumentRoot /var/www/html/public
    ServerName localhost
    
    # Directory configuration
    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted
        
        # URL Rewriting for clean URLs
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>
    
    # Security headers
    <IfModule mod_headers.c>
        Header always set X-Content-Type-Options nosniff
        Header always set X-Frame-Options DENY
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self'"
    </IfModule>
    
    # Hide sensitive files
    <FilesMatch "\.(env|log|ini)$">
        Require all denied
    </FilesMatch>
    
    # Allow access to public directory
    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted
        
        # Cache static assets
        <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|woff|woff2|ttf|svg)$">
            ExpiresActive On
            ExpiresDefault "access plus 1 month"
            Header append Cache-Control "public"
        </FilesMatch>
    </Directory>
    
    # Specific rules for assets directory
    <Directory /var/www/html/public/assets>
        AllowOverride None
        Require all granted
        
        # Enable compression for text files
        <FilesMatch "\.(css|js)$">
            SetOutputFilter DEFLATE
        </FilesMatch>
    </Directory>
    
    # Prevent access to certain directories
    <DirectoryMatch "/var/www/html/(config|app|helpers|storage)">
        Require all denied
    </DirectoryMatch>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>